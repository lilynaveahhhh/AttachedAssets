option_settings:
  # AWS EB environment settings
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    PORT: 5000
    
  # Load balancer configuration
  aws:elasticbeanstalk:environment:
    EnvironmentType: LoadBalanced
    LoadBalancerType: application
    ServiceRole: aws-elasticbeanstalk-service-role

  # Instance settings
  aws:autoscaling:launchconfiguration:
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    InstanceType: t3.micro
    
  # Auto Scaling settings
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 4
    
  aws:autoscaling:trigger:
    BreachDuration: 5
    LowerThreshold: 20
    MeasureName: CPUUtilization
    Period: 5
    Statistic: Average
    Unit: Percent
    UpperThreshold: 85

  # Health check settings
  aws:elasticbeanstalk:environment:process:default:
    DeregistrationDelay: 20
    HealthCheckInterval: 15
    HealthCheckPath: /health
    HealthCheckTimeout: 5
    HealthyThresholdCount: 3
    UnhealthyThresholdCount: 5
    Port: 5000
    Protocol: HTTP
    StickinessEnabled: true
    StickinessPolicy: lb_cookie

  # VPC Configuration
  aws:ec2:vpc:
    VPCId: vpc-xxxxxx  # Replace with your VPC ID
    Subnets: subnet-xxxxxx,subnet-yyyyyy  # Replace with your subnet IDs
    ELBSubnets: subnet-xxxxxx,subnet-yyyyyy  # Replace with your subnet IDs
    AssociatePublicIpAddress: true

  # Enhanced health monitoring
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    ConfigDocument: 
      Version: 1
      CloudWatchMetrics:
        Instance:
          CPUIrq: 60
          LoadAverage5min: 60
          RootFilesystemUtil: 60
        Environment:
          InstancesSevere: 60
          InstancesDegraded: 60
          ApplicationRequests5xx: 60
          ApplicationRequests4xx: 60
          ApplicationLatencyP99.9: 60

container_commands:
  01_install_dependencies:
    command: "npm ci --only=production"
  02_build:
    command: "npm run build"